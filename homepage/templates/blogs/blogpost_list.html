{% extends "base.html" %}
{% load staticfiles %}

{% block content %}
  <h1 class="display-3">{{ blog.title }}</h1>
  <p class="lead">
    {{ blog.description }}
  </p>
  <a href="{% url "blogs:blogpost-feed" slug=blog.slug %}"><img src='/static/images/Feed-icon.svg'></img></a>
  {% if user.is_authenticated %}
      <a class="btn btn-primary btn-lg" role="button" href="{% url "blogs:blogpost-create" slug=blog.slug %}">Create Arcticle</a>
  {% endif %}
  <hr class="my-4">

{% for blogpost in blogposts %}
  <article>
    <header>
      <h1>{{ blogpost.title }}</h1>
      <a href="{% url "blogs:blogpost-detail" blog_slug=blog.slug slug=blogpost.slug %}">
        <time date-time="{{ blogpost.created|date:"c" }}">{{ blogpost.created }}</time>
      </a>
    </header>
    <section>
      {{ blogpost.processed_content|safe }}
    </section>
  </article>
  <hr class="my-4">
{% endfor %}

<nav aria-label="pagination">
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">previous</a><li>
    {% endif %}
    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">next</a></li>
    {% endif %}
  </ul>
</nav>
{% endblock content %}

{% block template_script %}
<script>
var curImage = null;
var modalImage = $('.modal-image');
var modalFooter = $('.modal-footer');

function setButtons(curImage, modalFooter) {
    var buttons = "";
    if (curImage.data('prev')) {
        buttons = buttons + '<button id="prev" type="button" class="btn btn-primary">Prev</button>';
    } else {
        buttons = buttons + '<button id="prev" type="button" class="btn btn-primary disabled">Prev</button>';
    }
    if (curImage.data('next')) {
        buttons = buttons + '<button id="next" type="button" class="btn btn-primary">Next</button>';
    } else {
        buttons = buttons + '<button id="next" type="button" class="btn btn-primary disabled">Next</button>';
    }
    modalFooter.html(buttons);
}

function setModalImage(el) {
    curImage = el;
    modalImage.attr("src", curImage.attr("src")).attr("srcset", curImage.attr("srcset"));
    modalImage.parent().attr("href", curImage.data("full"));
    setButtons(curImage, modalFooter);
}

function replaceImage(which) {
    if (curImage) {
        if (curImage.data(which)) {
            setModalImage($('#' + curImage.data(which)));
        }
    }
}

$('body').on('click', 'button', function() {
    replaceImage($(this).attr('id'));
});

$(document).keydown(function (e) {
    if (e.keyCode == 37) {
        replaceImage('prev');
    }
    if (e.keyCode == 39) {
        replaceImage('next');
    }
});

$('.gallery-modal').click(function(e) {
    setModalImage($(e.target));
});
</script>
{% endblock template_script %}
