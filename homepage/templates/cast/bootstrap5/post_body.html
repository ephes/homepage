{% load wagtailcore_tags %}
{% load i18n %}
{% load indieweb_tags %}

{% if page %}
  <article class="{% if render_detail %}post-detail{% else %}post-card{% endif %} h-entry">
    <header>
      <h2 class="p-name {% if render_detail %}post-title{% else %}post-card-title{% endif %}">
        <a class="u-url" href="{{ page.page_url }}">{{ page.title }}</a>
        {% if render_for_feed and comments_are_enabled %}
          {% translate "(click here to comment)" %}
        {% endif %}
      </h2>
    <!-- link is on one line to avoid underlined whitespace -->
      <div class="post-card-meta">
        <a href="{{ page.page_url }}"><time class="dt-published" datetime='{{ page.visible_date|date:"c" }}'>{{ page.visible_date|date }}</time></a>
      </div>
      {% if page.owner and page.owner.profile %}
        <div class="p-author h-card" style="display: none;">
          <img
            class="u-photo"
            src="{{ page.owner.profile.photo_url }}"
            alt="{{ page.owner.profile.name|default:page.owner.get_full_name|default:page.owner.username }}"
            loading="lazy"
            decoding="async"
          >
          <a class="u-url" href="{{ page.owner.profile.url }}">
            <span class="p-name">{{ page.owner.profile.name|default:page.owner.get_full_name|default:page.owner.username }}</span>
          </a>
        </div>
      {% else %}
        {# Fallback for pages without owner #}
        <span class="p-author h-card" style="display: none;">
          <img
            class="u-photo"
            src="https://d2b7dn9rofvhjd.cloudfront.net/uploads/jochen-cover-profile_8SKdFNe.webp"
            alt="{{ blog.author }}"
            loading="lazy"
            decoding="async"
          >
          <span class="p-name">{{ blog.author }}</span>
          <a class="u-url" href="/jochen/" aria-label="{{ blog.author }} profile"></a>
        </span>
      {% endif %}
    </header>
    <div class="{% if render_detail %}post-body{% else %}post-card-excerpt{% endif %} e-content">
      {% for block in page.body %}
      {# this is either an overview or detail block #}
        {% if block.block_type != "detail" or render_detail %}
          <section class="block-{{ block.block_type }}">
            {% for block in block.value %}
            {# this is a block of content like image, gallery or audio #}
              <section class="block-{{ block.block_type }}">
                {% include_block block %}
              </section>
            {% endfor %}
          </section>
          {% if not render_detail %}
            {% block detail_link %}
              <div class="post-card-readmore">
                <a href="{{ page.page_url }}" aria-label="{% trans "Read more about" %} {{ page.title }}">{% trans "Read more" %} â†’</a>
              </div>
            {% endblock %}
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>
  </article>
{% endif %}
